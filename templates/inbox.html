{% extends "base.html" %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="fas fa-envelope"></i> Messaggi</h3>
        </div>
        <div class="card-body">
            <!-- Tabs Navigation -->
            <ul class="nav nav-tabs mb-4" id="messagesTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="received-tab" data-toggle="tab" href="#received" role="tab">
                        <i class="fas fa-inbox"></i> Ricevuti <span class="badge badge-primary">{{ received|length }}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="sent-tab" data-toggle="tab" href="#sent" role="tab">
                        <i class="fas fa-paper-plane"></i> Inviati <span class="badge badge-secondary">{{ sent|length }}</span>
                    </a>
                </li>
            </ul>

            <!-- Tabs Content -->
            <div class="tab-content" id="messagesTabsContent">
                <!-- Received Messages Tab -->
                <div class="tab-pane fade show active" id="received" role="tabpanel">
                    {% if received %}
                        <div class="list-group">
                            {% for message in received %}
                                <div class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1">
                                                <i class="fas fa-user-circle text-success"></i> 
                                                <strong>Da: {{ message.sender.display_name or message.sender.username }}</strong>
                                            </h6>
                                            <p class="mb-2">{{ message.content }}</p>
                                            <small class="text-muted">
                                                <i class="fas fa-clock"></i> {{ message.timestamp.strftime('%d/%m/%Y %H:%M') }}
                                            </small>
                                        </div>
                                        <div class="ml-3">
                                            <a href="{{ url_for('messages.send_message', user_id=message.sender.id) }}" 
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-reply"></i> Rispondi
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5 text-muted">
                            <i class="fas fa-inbox fa-4x mb-3"></i>
                            <p class="h5">Nessun messaggio ricevuto</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Sent Messages Tab -->
                <div class="tab-pane fade" id="sent" role="tabpanel">
                    {% if sent %}
                        <div class="list-group">
                            {% for message in sent %}
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <div>
                                            <h6 class="mb-1">
                                                <i class="fas fa-user-circle text-primary"></i> 
                                                <strong>A: {{ message.recipient.display_name or message.recipient.username }}</strong>
                                            </h6>
                                            <p class="mb-2">{{ message.content }}</p>
                                            <small class="text-muted">
                                                <i class="fas fa-clock"></i> {{ message.timestamp.strftime('%d/%m/%Y %H:%M') }}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5 text-muted">
                            <i class="fas fa-paper-plane fa-4x mb-3"></i>
                            <p class="h5">Nessun messaggio inviato</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}